<Page
    x:Class="QBDrumMap.Views.PluginPage"
    Style="{DynamicResource MahApps.Styles.Page}"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:bh="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:behaviors="clr-namespace:libQB.Behaviors;assembly=libQB"
    xmlns:Dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
    xmlns:resx="clr-namespace:QBDrumMap.Properties"
    xmlns:vm="clr-namespace:QBDrumMap.ViewModels.Controls"
    xmlns:Controls="clr-namespace:QBDrumMap.Views.Controls"
    Dialog:DialogParticipation.Register="{Binding}"
    mc:Ignorable="d"
    Loaded="Page_Loaded"
    d:DesignHeight="450" d:DesignWidth="1000">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="{StaticResource MediumLeftMargin}" VerticalAlignment="Center" Orientation="Horizontal">
            <ContentControl Focusable="False" Content="{StaticResource PluginPageIcon}" Margin="8,2,0,0"/>
            <TextBlock Style="{StaticResource PageTitleStyle}" Text="{x:Static resx:Resources.Title_PluginPage}"/>
        </StackPanel>

        <Grid Grid.Row="1" Margin="{StaticResource MediumLeftRightMargin}" Background="{DynamicResource MahApps.Brushes.Gray10}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Expander Grid.Column="0" Margin="4" ExpandDirection="Right" IsExpanded="True">
                    <Expander.Header>
                        <Label Content="Plugin">
                            <Label.LayoutTransform>
                                <RotateTransform Angle="90"/>
                            </Label.LayoutTransform>
                        </Label>
                    </Expander.Header>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" IsEnabled="{Binding IsCommandEnabled}">
                            <Button Style="{StaticResource IconButtonStyle}" Command="{Binding AddCommand}" ToolTip="{x:Static resx:Resources.ButtonAdd}">
                                <iconPacks:PackIconMaterial Focusable="False" Kind="Plus" Style="{StaticResource BasePackIconStyle}"/>
                            </Button>
                            <Button Style="{StaticResource IconButtonStyle}" Command="{Binding MoveTopCommand}" ToolTip="{x:Static resx:Resources.ButtonMoveTop}">
                                <iconPacks:PackIconMaterial Kind="ArrowCollapseUp" Style="{StaticResource BasePackIconStyle}"/>
                            </Button>
                            <Button Style="{StaticResource IconButtonStyle}" Command="{Binding MoveUpCommand}" ToolTip="{x:Static resx:Resources.ButtonMoveUp}">
                                <iconPacks:PackIconMaterial Kind="ArrowUp" Style="{StaticResource BasePackIconStyle}"/>
                            </Button>
                            <Button Style="{StaticResource IconButtonStyle}" Command="{Binding MoveDownCommand}" ToolTip="{x:Static resx:Resources.ButtonMoveDown}">
                                <iconPacks:PackIconMaterial Kind="ArrowDown" Style="{StaticResource BasePackIconStyle}"/>
                            </Button>
                            <Button Style="{StaticResource IconButtonStyle}" Command="{Binding MoveBottomCommand}" ToolTip="{x:Static resx:Resources.ButtonMoveBottom}">
                                <iconPacks:PackIconMaterial Kind="ArrowCollapseDown" Style="{StaticResource BasePackIconStyle}"/>
                            </Button>
                        </StackPanel>

                        <DataGrid x:Name="PluginDataGrid" Grid.Row="1" Style="{StaticResource DataGridStyle}" ItemsSource="{Binding PluginsView}" EnableRowVirtualization="False">
                            <bh:Interaction.Behaviors>
                                <behaviors:DataGridExtendBehavior
                                IsEditing="{Binding IsEditing}"
                                SelectedRows="{Binding SelectedPlugins}" 
                                SelectedRow="{Binding SelectedPlugin}" 
                                DeleteCommand="{Binding DeleteSelectedPluginsCommand}"/>
                            </bh:Interaction.Behaviors>
                            <DataGrid.RowValidationErrorTemplate>
                                <ControlTemplate/>
                            </DataGrid.RowValidationErrorTemplate>
                            <DataGrid.Columns>
                                <DataGridTextColumn
                                    Header="Name"
                                    Width="220"
                                    mah:TextBoxHelper.ClearTextButton="True"
                                    Binding="{Binding Name, ValidatesOnDataErrors=True, Converter={StaticResource TrimConverter}}">
                                    <DataGridTextColumn.EditingElementStyle>
                                        <StaticResource ResourceKey="DataGridEditingTextBoxStyle"/>
                                    </DataGridTextColumn.EditingElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Expander>

                <!-- Child Contents -->
                <Grid Grid.Column="1">
                    <Grid.Resources>
                        <DataTemplate DataType="{x:Type vm:KitPanelViewModel}">
                            <Controls:KitPanel/>
                        </DataTemplate>
                    </Grid.Resources>

                    <ContentControl Focusable="False" IsEnabled="{Binding IsContentEnabled}" Content="{Binding ContentViewModel}"/>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</Page>
